\documentclass[a4paper]{article}

%%%%%%%%%%%%%%%%%%page size%%%%%%%%%%%%%%%%%%
% \paperwidth=65cm
% \paperheight=160cm

%%%%%%%%%%%%%%%%%%%Package%%%%%%%%%%%%%%%%%%%
\usepackage[margin=3cm]{geometry}
\usepackage{mathtools,amsthm,amssymb}
\usepackage{centernot}
\usepackage{yhmath}
\usepackage{graphicx}
\usepackage{fontspec}
\usepackage{titlesec}
\usepackage{titling}
\usepackage{fancyhdr}
\usepackage{tabularx}
\usepackage[square, comma, numbers, super, sort&compress]{natbib}
\usepackage[unicode, pdfborder={0 0 0}, bookmarksdepth=-1]{hyperref}
\usepackage[usenames, dvipsnames]{color}
\usepackage[shortlabels, inline]{enumitem}
\setenumerate{itemsep=0.2em,topsep=0.25em}
\setitemize{itemsep=0.2em,topsep=0.25em}
\setdescription{itemsep=0.2em,topsep=0.25em}
\usepackage{xpatch}
\usepackage{relsize}
%\usepackage{parskip}
\parskip=0.5em

%\usepackage{tabto}     
%\usepackage{soul}      
%\usepackage{ulem}      
%\usepackage{wrapfig}   
%\usepackage{floatflt}  
\usepackage{float}     
\usepackage{caption}   
\usepackage{subcaption}
%\usepackage{setspace}  
\usepackage{mdframed}  
%\usepackage{multicol}  
%\usepackage[abbreviations]{siunitx}
%\usepackage{dsfont}   

%%%%%%%%%%%%%%%%%%%TikZ%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tikz}
\usepackage{tikz-cd}
%\usepackage{circuitikz}
\usetikzlibrary{calc}
\usetikzlibrary{arrows}
\usetikzlibrary{shapes}
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.pathmorphing}

\tikzstyle{every picture}+=[remember picture]

%%%%%%%%%%%%%%中文 Environment%%%%%%%%%%%%%%%
\usepackage[CheckSingle, CJKmath]{xeCJK}  % xelatex 中文
\usepackage{CJKulem}	% 中文字裝飾
%\setCJKmainfont[BoldFont=cwTeX Q Hei]{cwTeX Q Ming}
%\setCJKsansfont[BoldFont=cwTeX Q Hei]{cwTeX Q Ming}
%\setCJKmonofont[BoldFont=cwTeX Q Hei]{cwTeX Q Ming}

%%%%%%%%%%%%%%%%%font size%%%%%%%%%%%%%%%%%%%
%\def\normalsize{\fontsize{10}{15}\selectfont}
%\def\large{\fontsize{12}{18}\selectfont}
%\def\Large{\fontsize{14}{21}\selectfont}
%\def\LARGE{\fontsize{16}{24}\selectfont}
%\def\huge{\fontsize{18}{27}\selectfont}
%\def\Huge{\fontsize{20}{30}\selectfont}

%%%%%%%%%%%%%%%Theme Input%%%%%%%%%%%%%%%%%%%
%\input{themes/chapter/neat}
%\input{themes/env/problist}

%%%%%%%%%%%titlesec settings%%%%%%%%%%%%%%%%%
%\titleformat{\chapter}{\bf\Huge}
            %{\arabic{section}}{0em}{}
%\titleformat{\section}{\centering\Large}
            %{\arabic{section}}{0em}{}
%\titleformat{\subsection}{\large}
            %{\arabic{subsection}}{0em}{}
%\titleformat{\subsubsection}{\bf\normalsize}
            %{\arabic{subsubsection}}{0em}{}
%\titleformat{command}[shape]{format}{label}
            %{gutter}{before}[after]

%%%%%%%%%%%%variable settings%%%%%%%%%%%%%%%%
%\numberwithin{equation}{section}
%\setcounter{secnumdepth}{4}
%\setcounter{tocdepth}{1}
%\setcounter{section}{0}
%\graphicspath{{images/}}

%%%%%%%%%%%%%%%page settings%%%%%%%%%%%%%%%%%
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\setlength{\headheight}{15pt}  % with titling
\setlength{\droptitle}{-2.5cm}
%\posttitle{\par\end{center}}  % distance between title and content
\parindent=0pt % indent size
%\parskip=1ex    % line space
%\pagestyle{empty}  % empty: no page number
%\pagestyle{fancy}  % fancy: fancyhdr

% use with fancygdr
%\lhead{\leftmark}
%\chead{}
%\rhead{}
%\lfoot{}
%\cfoot{}
%\rfoot{\thepage}
%\renewcommand{\headrulewidth}{0.4pt}
%\renewcommand{\footrulewidth}{0.4pt}

%\fancypagestyle{firststyle}
%{
  %\fancyhf{}
  %\fancyfoot[C]{\footnotesize Page \thepage\ of \pageref{LastPage}}
  %\renewcommand{\headrule}{\rule{\textwidth}{\headrulewidth}}
%}

%%%%%%%%%%%%%%%renew command%%%%%%%%%%%%%%%%%
% \renewcommand{\contentsname}{Table of Content}
% \renewcommand{\refname}{Reference}
\renewcommand{\abstractname}{\LARGE Abstract}

%%%%%%%%symbol and function settings%%%%%%%%%
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}
\DeclarePairedDelimiter{\inpd}{\langle}{\rangle} % inner product
\DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\floor}{\lfloor}{\rfloor}
\DeclareMathOperator{\adj}{adj}
\DeclareMathOperator{\sech}{sech}
\DeclareMathOperator{\csch}{csch}
\DeclareMathOperator{\arcsec}{arcsec}
\DeclareMathOperator{\arccot}{arccot}
\DeclareMathOperator{\arccsc}{arccsc}
\DeclareMathOperator{\arccosh}{arccosh}
\DeclareMathOperator{\arcsinh}{arcsinh}
\DeclareMathOperator{\arctanh}{arctanh}
\DeclareMathOperator{\arcsech}{arcsech}
\DeclareMathOperator{\arccsch}{arccsch}
\DeclareMathOperator{\arccoth}{arccoth}
\newcommand{\np}[1]{\\[{#1}] \indent}
\newcommand{\tr}[1]{{#1}^\mathrm{t}}
%%%% Geometry Symbol %%%%
\newcommand{\degree}{^\circ}
\newcommand{\Arc}[1]{\wideparen{{#1}}}
\newcommand{\Line}[1]{\overleftrightarrow{{#1}}}
\newcommand{\Ray}[1]{\overrightarrow{{#1}}}
\newcommand{\Segment}[1]{\overline{{#1}}}
%%%% Math symbol %%%%
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\Nb}{\mathbb{N}}
\newcommand{\Zb}{\mathbb{Z}}
\newcommand{\Qb}{\mathbb{Q}}
\newcommand{\Rb}{\mathbb{R}}
\newcommand{\Cb}{\mathbb{C}}
\newcommand{\Hb}{\mathbb{H}}
\newcommand{\Fb}{\mathbb{F}}
\newcommand{\Fbx}{\mathbb{F}^\times}
\newcommand{\Qbx}{\mathbb{Q}^\times}
\newcommand{\Rbx}{\mathbb{R}^\times}
\newcommand{\Cbx}{\mathbb{C}^\times}
\newcommand{\Hbx}{\mathbb{H}^\times}

\usetikzlibrary{matrix}

\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Image}{Im}
\DeclareMathOperator{\Char}{char}
\DeclareMathOperator{\Fix}{Fix}
\DeclareMathOperator{\Inn}{Inn}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Isom}{Isom}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Exp}{Exp}
\DeclareMathOperator{\Syl}{Syl}
\newcommand{\ob}{\overline}
\DeclareMathOperator{\ord}{ord}
\DeclarePairedDelimiter{\gen}{\langle}{\rangle} % generator
%\newcommand*\quot[2]{{^{\textstyle #1}\Big/_{\textstyle #2}}}
\newcommand*\quot[2]{{#1}/{#2}}
\newcommand\bij{\lhook\joinrel\twoheadrightarrow}
\newcommand\toone{\hookrightarrow}
\newcommand\onto{\twoheadrightarrow}
\newcommand\acts{\curvearrowright}
\newcommand\revacts{\curvearrowleft}

% cycle group \cycle{1,2,3} => (1 2 3)
\ExplSyntaxOn
\NewDocumentCommand{\cycle}{ O{\;} m }
 {
  (
  \alec_cycle:nn { #1 } { #2 }
  )
 }

\seq_new:N \l_alec_cycle_seq
\cs_new_protected:Npn \alec_cycle:nn #1 #2
 {
  \seq_set_split:Nnn \l_alec_cycle_seq { , } { #2 }
  \seq_use:Nn \l_alec_cycle_seq { #1 }
 }
\ExplSyntaxOff

\newcommand\Div{\,\big|\,}
\newcommand\nDiv{\,\big\not|\,}
\newcommand\relmiddle[1]{\mathrel{}\middle#1\mathrel{}}
\newcommand{\RNum}[1]{\uppercase\expandafter{\romannumeral #1\relax}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\renewcommand{\proofname}{\bf pf:}
\newtheoremstyle{mystyle}% custom style
  {6pt}{15pt}%      top and bottom margin
  {}%               content style
  {}%               indent
  {\bf}%            head style
  {.}%              after head
  {1em}%            distance between head and content
  {}%               Theorem head spec (can be left empty, meaning 'normal')

\newtheorem{theorem}{Theorem}
\newtheorem{formula}{Formula}
\newtheorem{conclusion}{Conclusion}
\newtheorem{lemma}{Lemma}

\theoremstyle{remark}
\newtheorem*{remark}{Remark}

\theoremstyle{definition}
\newtheorem{example}{Example}

\theoremstyle{definition}
\newtheorem{definition}{Definition}

\theoremstyle{plain}
\newtheorem{proposition}{Proposition}

\DeclareMathOperator*{\freeprod}{\raisebox{-0.4ex}{\scalebox{2}{$\ast$}}\!}
\newcommand{\gid}{\mathfrak{G}}

\makeatletter
\newcommand{\proofpart}[1]{%
  \par
  \addvspace{\medskipamount}%
  \noindent\emph{(#1)}\par\nobreak
  \addvspace{\smallskipamount}%
  \@afterheading
}
\makeatother
\title{Free Product}
\date{}

\begin{document}
  \maketitle
  \vspace*{-2.5cm}
  \begin{definition}
    Let $\mathcal{S} = \{ G_\alpha : \alpha \in \mathcal{A} \}$ be a nonempty set of groups $G_{\alpha}$
    (We shall assume that these groups are disjoint).
    The {\bf free product} of $\mathcal{S}$ is a pair $(G, \{i_\alpha\})$ where $G$ is a group
    and $i_{\alpha} :: G_\alpha \to G$ are homomorphism which has the following universal property:
    For any group $H$ and homomorphisms $\varphi_\alpha :: G_\alpha \to H$, 
    there exists a unique group homomorphism $\varphi :: G \to H$ such that $\varphi \circ i_\alpha = \varphi_\alpha$ for
    all $\alpha \in \mathcal{A}$ (e.g., the diagram below commutes).
    We write $G = \freeprod_\alpha G_\alpha$ (some also write
    $G = \prod^* G_\alpha$ or $G = \coprod G_\alpha$).
  \end{definition}

  \begin{figure}[h]
    \centering
    \begin{tikzpicture}
      \matrix (m) [matrix of math nodes, row sep=3em, column sep=4em] {
        G_\alpha & \freeprod_\alpha G_\alpha \\
         & H \\
      };
      \path[-latex]
      (m-1-1) edge node[above]{$i_\alpha$} (m-1-2);

      \path[-latex]
      (m-1-2) edge node[right]{$\exists \varphi$} (m-2-2);

      \path[-latex]
      (m-1-1) edge node[midway, below left, xshift=0.1cm, yshift=0.1cm]{$\varphi_\alpha$} (m-2-2);
    \end{tikzpicture}
    \caption{The diagram of the free product}
  \end{figure}

  \begin{remark}
    The free product could also be defined as the {\bf coproduct} of $\{ G_\alpha \}$ if we consider the morphisms
    as group homomorphisms in the category of groups.
  \end{remark}


  \begin{definition}
    A {\bf word} (with respect to a free product) is a finite sequence $g_1 g_2 \cdots g_n$ such that
    every $g_i$ is in one of $G_\alpha$. Each $g_i$ in it is called a {\bf factor}.
    We shall denote the empty word by $1$. The {\bf length}
    of a word is the number of factors in it. Define $W(\{G_\alpha\})$ or simply $W$ 
    to be the set of all of the words. For each $g$, let $\gid(g)$ be the group which $g$ belongs, 
    and $g^{-1}$ be the inverse of $g$ in that group.

    Write $xy$ as the {\bf concatenate} of two words $x, y$.

    We define two {\bf reducing operations} on words
    \begin{enumerate}
      \item Drop a factor $g_i$ which is the identity element.
      \item Collapse two factors $g_i g_{i+1}$ to a single one $g^*$ if $\gid(g_i) = \gid(g_{i+1})$
        and their product in that group is $g^*$.
    \end{enumerate}
    Together with the inverse of these two reducing operations, we have four {\bf operations}
    that could alter a word.

    Two words $x$ and $y$ are said to be {\bf equivalent} if there is a finite sequence of 
    operations that change $x$ to $y$.

    A word $x$ is a {\bf reduced word} if no reducing operation could be preformed on it. That is,
    $x$ contains no factor $g_i$ which is the identity of a group $G_\alpha$, and contains no
    consecutive factors $g_i, g_{i+1}$ that belong to the same group.
  \end{definition}
  \begin{proposition}
    The statement above defines a valid equivalent relation $\sim$.
  \end{proposition}
  \begin{proof}
    We check that
    \begin{itemize}
      \item $x \sim x$ clearly from definition.
      \item $x \sim y \implies y \sim x$ since we have inverse operations.
      \item $x \sim y \land y \sim z \implies x \sim z$ since we could combine the sequence 
        of operations that changes $x$ to $y$ and that changes $y$ to $z$ to obtain a sequence 
        of operations that changes $x$ to $z$.
    \end{itemize}
  \end{proof}

  \begin{proposition}
    Free product exists and is unique up to isomorphism.
  \end{proposition}

  \begin{proof}[Proof of existence]
    Denote the equivalence classes by $[x]$ using the equivalence relation mentioned above.
    Let $G = W\!/\mathord\sim = \big\{ [x] : x \in W \big\}$ and define the multiplication as 
    $[x][y] = [xy]$. We shall check that the multiplication is well defined.

    Suppose that $x$ and $x'$ differ by only one operations. Then for all $y$, it is easy to 
    see that $xy \sim x'y$ and $yx \sim yx'$ since we could still preform that 
    operation on the $x, x'$ part and turn the former word to the later. Iterating this
    kind of equivalence shows that $v \sim v'$ and $w \sim w'$ implies $vw \sim v'w'$. Hence 
    the multiplication is well defined.

    Then we check that with this multiplication, $G$ is indeed a group.
    \begin{description}[style=standard]
      \item[associative:] Simply by the associative of word concatenation.
      \item[indentity:] The equivalent class of empty word $[1]$ is the indentity obviously.
      \item[inverse:] For any word $x = g_1 g_2 \cdots g_n$. Let $y = g^{-1}_n g^{-1}_{n-1} \cdots g^{-1}_1$.
        It is easy to see that $[xy] = [yx] = [1]$, hence $[x][y] = [y][x] = [1]$.
    \end{description}
    Let $i_\alpha(g) = [g]$, then each $i_\alpha$ is a homomorphism since $i_\alpha(g_1 g_2) = [g_1 g_2]
    = [g_1] [g_2] = i_\alpha(g_1) i_\alpha(g_2)$.

    Now, given $H$ and homomorphisms $\varphi_\alpha$, we shall construct $\varphi$. First define 
    $\Phi :: W \to H$ by
    \[ 
      \Phi(w) =
      \begin{cases}
        \, 1_H & \text{if } w \text{ is the empty word.} \\
        \, \varphi_\alpha(g) & \text{if } w = g \text{ has length 1 and } g \in G_\alpha. \\ 
        \, \Phi(g) \Phi(w') & \text{otherwise, and let } w = g w'. \\ 
      \end{cases}
    \]
    It is easy to see that $\Phi(w_1 w_2) = \Phi(w_1) \Phi(w_2)$. Let $\varphi([w]) = \Phi(w)$ for
    each $[w] \in G$ and we shall check that it is well defined. It is equivalent to
    ensure that $w \sim w' \implies \Phi(w) = \Phi(w')$. So we prove that
    \begin{itemize}
      \item $\Phi(w_1 w_2) = \Phi(w_1 1_{G_\alpha} w_2)$: Since $\Phi(w_1 1_{G_\alpha} w_2) 
        = \Phi(w_1) \Phi(1_{G_\alpha}) \Phi(w_2) = \Phi(w_1) \varphi_\alpha(1_{G_\alpha}) \Phi(w_2)
        = \Phi(w_1) \Phi(w_2) = \Phi(w_1 w_2)$ by the fact that every homomorphism $\varphi_\alpha$ maps
        identity to identity.
      \item $\Phi(w_1 g^* w_2) = \Phi(w_1 g_1 g_2 w_2)$, if $g^* = g_1 g_2$: WLOG assume $g^* \in G_\alpha$, then 
        $\Phi(w_1 g^* w_2) = $ \\
        $ \Phi(w_1) \phi_\alpha(g^*) \Phi(w_2) = \Phi(w_1) \phi_\alpha(g_1 g_2) \Phi(w_2)
        = \Phi(w_1) \phi_\alpha(g_1) \phi_\alpha(g_2) \Phi(w_2) = \Phi(w_1 g_1 g_2 w_2)$. 
    \end{itemize}
    Hence if $w \sim w'$, using the two equalities above and iterating through a sequences of
    operations that changes $w$ to $w'$, we found that $\Phi(w) = \Phi(w')$, thus $\varphi$ is
    well defined. Also $\varphi([w_1][w_2]) = \varphi([w_1 w_2]) = \Phi(w_1 w_2) = \Phi(w_1) \Phi(w_2)
    = \varphi([w_1]) \varphi([w_2])$, so $\varphi$ is indeed a homomorphism.

    Finally, we show that $\varphi$ is unique. It is easy to see that each element
    $[w] \in G$ could be generate by $\big\{[g] : g \in \bigcup_\alpha G_\alpha\big\}$,
    the equivalent classes of words with length $1$, 
    and for each $g_\alpha$ in each $G_\alpha$, $\varphi([g_\alpha]) = \varphi(i_\alpha(g_\alpha)) =
    \varphi_\alpha(g_\alpha)$ is determined, hence $\varphi$ is unique.
  \end{proof}

  \begin{proof}[Proof of uniqueness]
    The $G$ constructed above is a coproduct of $\{G_\alpha\}$. By the uniqueness of coproduct, the proof is complete.

    Or we could proof it in the old-fashioned way. If $(G', \{i'_\alpha\})$ is another pair that satisfies
    the universal property. By the univeral property of $G$, exists $\varphi$, $\varphi \circ i_s = i'_s$.
    Swapping the roles of $G$ and $G'$, we know that exists $\varphi'$, $\varphi' \circ i'_s = i_s$.
    So $\varphi' \circ \varphi \circ i_s = i_s$, but notice that the identity mapping $1_G$ also
    satisfies $1_G \circ i_s = i_s$. By the uniqueness of mapping in the definition of
    universal property, we have $1_G = \varphi' \circ \varphi$, similary $1_{G'} = \varphi \circ \varphi'$
    so $\varphi$ 1-1 onto and hence $G \cong G'$.
  \end{proof}

  Since we construct the free product by equivalence classes, some may wish to find a canonical
  representative for each equivalence class. So we prove the following proposition.

  \begin{proposition}
    Each word is equivalent to exactly one reduced word, and hence each equivalence class
    has a unique reduced word.
  \end{proposition}

  \begin{proof}
    Let $w = g_1 g_2 \cdots g_n$ is a word in $W$. We associate to $w$ a sequence of reduced words
    $x_0, x_1, \cdots, x_n$ in $W$ define by the following recursive algorithm: \\
    Let $x_0$ be the empty word $1$. If $x_{i-1} = h_1 h_2 \cdots h_k$ (when $x_{i-1}$ is an empty word, $k = 0$),
    define $x_i$ by
    \[
      x_i = \begin{cases}
        h_1 \cdots h_k & \text{if } g_i = 1_{\gid(g_i)} \\
        g_i & \text{otherwise, if } k = 0 \\
        h_1 \cdots h_k g_i & \text{otherwise, if } \gid(h_k) \neq \gid(g_i) \\
        h_1 \cdots h_{k-1} & \text{otherwise, if } h_k g_i = 1_{\gid(g_i)} \\
        h_1 \cdots h_{k-1} g^* & \text{otherwise, and let } h_k g_i = g^* \neq 1_{\gid(g_i)} \\
      \end{cases}
    \]
    and let $r(w) = x_n$.

    Then we could check inductively such that for each $i$, the following holds:
    \begin{itemize}
      \item $x_i \sim g_1 g_2 \cdots g_i$: By induction, $x_{i-1} \sim g_1 g_2 \cdots g_{i-1}$.
        Since in each case $x_i$ could be transformed from $x_{i-1} g_i$
        by some reducing operations. And we've already prove that $x \sim x', y \sim y' \implies xy \sim x'y'$,
        hence $x_i \sim x_{i-1} g_i \sim g_1 g_2 \cdots g_i$.
      \item Each $x_i$ is a reduced word: Since by induction we know that $x_{i-1} = h_1 \cdots h_k$ is reduced. 
        So if $x_i$ is obtain by case \#$1, 2, 4$, $x_i$ is a reduced word. In case \#3, because $g_i \neq 1_{\gid(g_i)}$
        and $\gid(g_i) \neq \gid(h_k)$, and in case \#5, $g^* \neq 1_{\gid(g^*)} \text{ and } \gid(g^*) = h_k \neq h_{k-1}$,
        so $x_i$ is a reduced word in both case.
    \end{itemize}
    So each word $w$ is equivalent to a reduce word $r(w)$.

    If $w = g_1 \cdots g_n$ is reduced, than $x_1$ is obtained by the second case, and $x_i, i > 1$ is
    obtained by the third case, hence $r(w) = g_1 \cdots g_n = w$.

    Now consider the equivalent words
    \[ w = g_1 \cdots g_j g_{j+1} \cdots g_n \quad\text{and}\quad w' = g_1 \cdots g_j 1_{G_\alpha} g_{j+1} \cdots g_n \]
    which induce $x_0, \cdots, x_n$ and $x'_0, \cdots, x'_{n+1}$ by the algorithm above.
    We have $x_j = x'_j$, and $x'_{j+1}$ would be produce by case \#1 and hence $x'_{j+1} = x'_j = x_j$.
    So after appending the same factors $g_{j+1} \cdots g_n$, the output should be the same, hence
    $x_n = x'_{n+1} \implies r(w) = r(w')$.

    Next consider the equivalent words
    \[ w = g_1 \cdots g_{j-1} g_j g_{j+1} g_{j+2} \cdots g_n 
      \quad\text{and}\quad w' = g_1 \cdots g_{j-1} g^* g_{j+2} \cdots g_n \]
    Similarly, they would induce $x_0, \cdots, x_n$ and $x'_0, \cdots, x'_{n-1}$, and
    we have $x_{j-1} = x'_{j-1}$. Let $x_{j-1} = h_1 h_2 \cdots h_k$. 
    Now there are a lot of painful cases to check.
    \begin{itemize}
      \item $g_j = 1_{\gid(g_j)} \text{ or } g_{j+1} = 1_{\gid(g_{j+1})}$: 
        If $g_j = 1_{\gid(g_j)}$ then $g^* = g_{j+1}$, so this case turn out to be the case above ($w$
        is formed by inserting an identity into $w'$). Similar argument holds when $g_{j+1} = 1_{\gid(g_j)}$,
        hence we could assume $g_j, g_{j+1} \neq 1_{\gid(g_j)}$ below.
      \item otherwise, $k = 0$, or $k \neq 0$ but $\gid(h_k) \neq \gid(g_j)$. There are two cases:
        \begin{itemize}
          \item $g^* = 1_{\gid(g_j)}$: Then $x'_j = x_{j-1}$ (case \#1), $x_j = x_{j-1} g_j$ (case \#2 
            or \#3) and $x_{j+1} = x_{j-1}$ (case \#4).
          \item $g^* \neq 1_{\gid(g_j)}$: Then $x'_j = x_{j-1} g^*$ (case \#2, \#3),
            $x_j = x_{j-1} g_j$ (case \#2, \#3) and $x_{j+1} = x_{j-1} g^*$ (case \#3).
        \end{itemize}
      \item otherwise $\gid(h_k) = \gid(g_j)$, and if $h_k g_j = 1_{\gid(g_j)}$,
        let $y = h_1 \cdots h_{k-1}$:
        \begin{itemize}
          \item $g^* = 1_{\gid(g_j)}$: Then $g_j g_{j+1} = g^* = 1 = h_k g_j$, which forces
            $h_k = g_{j+1} = g^{-1}_j \neq 1_{\gid(g_j)}$.  
            Hence $x'_j = x_{j-1}$ (case \#1), $x_j = h_1 \cdots h_{k-1}$
            (case \#4) and $x_{j+1} = h_1 \cdots h_k = x_{j-1}$ (case \#2 or \#3, since $x_{j-1}$ reduced, 
            $k-1 = 0$ or $\gid(h_{k-1}) \neq \gid(h_k) = \gid(g_{j+1})$).
          \item $g^* \neq 1_{\gid(g_j)}$: 
            Now $h_k g^* = g_{j+1} \neq 1_{\gid(g_j)}$ by assumption. Then
              $x'_j = y g_{j+1}$ (case \#5), $x_j = y$ (case \#4) and $x_{j+1} = y g_{j+1}$ 
                (case \#2, \#3).
        \end{itemize}

      \item otherwise $h_k g_j = \hat{g} \neq 1_{\gid(g_j)}$, let $y = h_1 \cdots h_{k-1}$:
        \begin{itemize}
          \item $g^* = 1_{\gid(g_j)}$: Then $x'_j = x_{j-1} = y h_k$ (case \#1), 
            $x_j = y \hat{g}$ (case \#5) and
            $x_{j+1} = y h_k$ (case \#5, since $\hat{g} g_{j+1} = h_k g_j g_{j+1} = h_k g^* = h_k \neq 1$). 
          \item $g^* \neq 1_{\gid(g_j)}$: Let $\tilde{g} = h_k g^* = h_k g_j g_{j+1} = \hat{g} g_{j+1}$, 
            then $x'_j = y \tilde{g}$ (case \#5), 
            $x_j = y \hat{g}$ (case \#5) and
            $x_{j+1} = y \tilde{g}$ (case \#5, since $\hat{g} g_{j+1} = \tilde{g}$). 
      \end{itemize}
    \end{itemize}
    No matter which case, the result is that $x'_j = x_{j+1}$.
    After appending the same factors $g_{j+2} \cdots g_n$, the output should be the same, hence
    $r(w) = r(w')$. Extend the result to an sequence of operations of word, we conclude that
    $w \sim w' \implies r(w) = r(w')$. If $w$ is equivalent to two reduced word $w', w''$,
    then $w' \sim w''$ hence $r(w') = r(w'')$. But we proved that $r(x) = x$ if $x$ is a reduced word,
    hence $w' = w''$.

    Finally, notice that if $w$ is not a reduced word, by definition it means that we could preform a reducing
    operation on $w$. After a reducing operation, the length of the word decrease. Repeat this process.
    Since the length couldn't decrease below $0$, eventually we would get a reduced word $w'$ which is equivalent to
    $w$.
    
    Combine the result above, we conclude that every word $w$ is equivalent to exactly one reduced
    word, and hence each equivalent class has exactly one reduced word.
  \end{proof}

  \begin{example}
    Consider $C_2 \ast C_3$, where $C_2 = \langle a \rangle, C_3 = \langle b \rangle$. By the
    theorem above, each element of $C_2 \ast C_3$ correspond to a reduced word in $W(\{a, b\})$.

    It is easy to see that all the reduced word in $W(\{a, b\})$ has the form
    \[ x = a^{n_1} b^{n_2} a^{n_3} b^{n_4} \cdots a^{n_{2k-1}} b^{n_{2k}} \]
    such that $n_{2i+1} = 1$ and $n_{2i} = 1 \text{ or } 2$, with the exception that
    $n_1, n_{2k}$ could be $0$.

    Any other word in $W(\{a, b\})$ could be reduced to the form. For example,
    \begin{align*}
      a a b b a a b a a a b b a &= a^2 b^2 a^2 b a^3 b^2 a \\
      &= 1_{C_2} \cdot b^2 \cdot 1_{C_2} \cdot b a b^2 a \\
      &= b^2 b a b^2 a = b^3 a b^2 a \\
      &= 1_{C_3} \cdot a b^2 a \\
      &= a b^2 a
    \end{align*}
  \end{example}

  \begin{proposition}
    Let $\mathcal{S} = \{ G_\alpha : \alpha \in \mathcal{A} \}$ be a set of groups, and suppose that
    $\big\langle S_\alpha \bigm| R_\alpha \big\rangle$ is a presentation for each $G_\alpha$, then 
    $\Big\langle \bigcup\limits_\alpha S_\alpha \mathrel{\Big|} \bigcup\limits_\alpha R_\alpha \Big\rangle$
    is a presentation of the free product $\freeprod_\alpha G_\alpha$.
  \end{proposition}

  Recall that $\big\langle S \bigm| R \big\rangle$ is defined to be $F(S) / N(R)$ where $F(S)$ is
  the free group of $S$ and $N(R)$ is the smallest normal subgroup containing $R$.

  \begin{proof}
    Let $S = \bigcup_\alpha S_\alpha, R = \bigcup_\alpha R_\alpha$ and define 
    $G = \big\langle S \bigm| R \big\rangle$. Now consider the function $\psi$ which
    carry each element $x \in S_\alpha$ to $F(S)$ by:
    \begin{enumerate}
      \item First carry it from $S_\alpha$ into $S$ by the inclusion map.
      \item Then carry it from $S$ into $F(S)$ by the mapping given by the free group.
    \end{enumerate}
    Now by the universal property of the free group, there exist a map 
    $\tilde{f}_\alpha :: F(S_\alpha) \to F(S)$. It is easy to see that $\tilde{f}_\alpha$
    simply maps a word $w \in F(S_\alpha)$ to the same word in $F(S)$.
    Compose with the quotient map $q$ from $F(S)$ to $F(S) / N(R) = G$, we get a map $f_\alpha$ from
    $F(S_\alpha)$ to $G$. 

    Now, let $q_\alpha$ be the quotient map from $F(S_\alpha)$ to $G_\alpha$.
    For each word $r \in R_\alpha \subseteq F(S_\alpha)$, $\tilde{f}_\alpha$ send $r$ into $R$,
    so $f_\alpha(r) = 1_G$, hence $\ker q_\alpha = N(R_\alpha) \subseteq \ker f_{\alpha}$ since $N(R_\alpha)$ is the smallest
    normal subgroup containing $R_\alpha$ and a kernal is always normal. By factor theorem, $f_\alpha$
    descends to a homomorphism $i_\alpha :: G_\alpha \to G$.

    If we could prove that $(G, i_\alpha)$ has the universal property of a free product, by the uniqueness
    of free product we would have $G \cong \freeprod_\alpha G_\alpha$.

    Let $H$ be a group, and let $\varphi_\alpha :: G_\alpha \to H$ be a system of homomorphisms.
    Consider $\tilde{\varphi}_\alpha :: F(S_\alpha) \to H$ by $\tilde{\varphi}_\alpha = \varphi_\alpha \circ q_\alpha$.
    Define $\tilde{g} :: S \to H$ which sending $x \in S$ by
    \begin{enumerate}
      \item First carry $x$ to one of the $S_\alpha$ by the inverse of inclusion map $\iota^{-1}$, 
        it could be done since $\{S_\alpha\}$ is consider to be disjoint.
      \item Then carry it into $F(S_\alpha)$ by the mapping given by the free group.
      \item Finally carry it into $H$ by $\tilde{\varphi}_\alpha$.
    \end{enumerate}
    Since $F(S)$ is the free group of $S$, by its universal property, exists a homomorphism $g :: F(S) \to H$.
    Now for each $r \in R \subseteq F(S)$, $r$ lies in a unique $R_\alpha$, so
    \[ g(r) = \tilde{\varphi}_\alpha(r) = \varphi_\alpha(q_\alpha(r)) = \varphi_\alpha(1_{G_\alpha}) = 1_H. \]
    Consequently $\ker q = N(R) \subseteq \ker g$, and by factor theorem, $g$ descends into a
    homomorphism $\varphi :: G \to H$. This $\varphi$ satisfies:
    \[
      \varphi \circ i_\alpha \circ q_\alpha = \varphi \circ f_\alpha
      = \varphi \circ q \circ \tilde{f}_\alpha
      = g \circ \tilde{f}_\alpha
      = \tilde{\varphi}_\alpha
      = \varphi_\alpha \circ q_\alpha
    \]
    and notice that $q_\alpha$ onto $G_\alpha$, hence we conclude that $\varphi \circ i_\alpha = \varphi_\alpha$.
    which proof that $G$ has the desire mapping required by the universal property for any $H$.
    \begin{figure}[h]
      \centering
      \begin{tikzpicture}
        \matrix (m) [matrix of math nodes, row sep=3em, column sep=4em] {
          S_\alpha & F(S_\alpha) & G_\alpha & H \\
          S & F(S) & G & \\
        };
        \path[-latex]
        (m-1-1.260) edge node[left]{$\iota$} (m-2-1.100);

        \path[latex-]
        (m-1-1.280) edge node[right, yshift=0.6mm]{$\iota^{-1}$} (m-2-1.80);

        \path[-latex]
        (m-1-1) edge node[above]{} (m-1-2);

        \path[-latex]
        (m-2-1) edge node[above]{} (m-2-2);
        
        \path[-latex]
        (m-1-2) edge node[above]{$q_\alpha$} (m-1-3);

        \path[-latex]
        (m-2-2) edge node[below]{$q$} (m-2-3);

        \path[-latex]
        (m-1-3) edge node[above]{$\varphi_\alpha$} (m-1-4);

        \path[-latex]
        (m-1-3) edge node[pos=0.65, right, xshift=-0.5mm, yshift=-0.5mm]{$i_\alpha$} (m-2-3);

        \path[-latex]
        (m-2-3.0) edge node[midway, below]{$\varphi$} (m-1-4.270);

        \path[-latex]
        (m-1-2) edge node[pos=0.35, left, xshift=0.5mm]{$\tilde{f}_\alpha$} (m-2-2);

        \path[-latex]
        (m-1-2) edge node[pos=0.3, above, xshift=0.5mm]{$f_\alpha$} (m-2-3);

        \path[-latex]
        (m-1-1) edge node[midway, above]{$\psi$} (m-2-2);

        \path[-latex]
        (m-2-1) edge node[pos=0.63, above, yshift=-0.5mm]{$\tilde{g}$} (m-1-4);

        \path[-latex]
        (m-2-2) edge node[pos=0.8, below, yshift=0.5mm]{$g$} (m-1-4.210);

        \path[-latex]
        (m-1-2) edge[bend left=25] node[midway, above, yshift=0.0mm]{$\tilde{\varphi}_\alpha$} (m-1-4);

        %\path[-latex]
        %(m-1-1) edge node[midway, below left, xshift=0.1cm, yshift=0.1cm]{$\varphi_\alpha$} (m-2-2);
      \end{tikzpicture}
      \caption{The commute diagram in the proof.}
    \end{figure}

    Finally, for the uniqueness, if $\varphi$ makes $\varphi_\alpha = i_\alpha \circ \varphi$, 
    then consider $h = \varphi \circ q$, since
    \[ \varphi_\alpha \circ q_\alpha = \varphi \circ i_\alpha \circ q_\alpha
      = \varphi \circ f_\alpha = \varphi \circ q \circ \tilde{f}_\alpha = h \circ \tilde{f}_\alpha. \]
    So $h$ is determined for all $x \in \bigcup\limits_\alpha \Image{\tilde{f}_\alpha}$. But 
    $\bigcup\limits_\alpha \Image{\tilde{f}_\alpha}$ contains all generator of $F(S)$ (i.e., all the 
    words with length $1$), hence $h$ is uniquely determined. Since $q$ is onto, we conclude 
    that $\varphi$ is also uniquely determined.

    Hence we prove that $G$ satisfies the universal property, and
    $ \Big\langle \bigcup\limits_\alpha S_\alpha \mathrel{\Big|} \bigcup\limits_\alpha R_\alpha \Big\rangle
    \cong \freeprod_\alpha G_\alpha $.
  \end{proof}

  \begin{example}
    Consider again $C_2 \ast C_3$. Since $C_2 = \langle a \mid a^2 \rangle, C_3 = \langle b \mid b^3 \rangle$,
    so $C_2 \ast C_3 = \langle a, b \mid a^2, b^3 \rangle$.
  \end{example}

  \begin{definition}
    Let $\mathcal{C}$ be a category, $X, Y, Z$ be objects, and $f :: Z \to X,\ g :: Z \to Y$ are
    two morphisms. The {\bf pushout} of the morphisms $f, g$ is a tuple $(P, i_1, i_2)$ such
    that $P$ is an object, $i_1 :: X \to P,\ i_2 :: Y \to P$ with $i_1 \circ f = i_2 \circ g$,
    and $(P, i_1, i_2)$ has the following universal property: 
    For any $(Q, j_1, j_2)$ satisfying $j_1 \circ f = j_2 \circ g$, there is an unique morphism 
    $\varphi :: P \to Q$ that makes $\varphi \circ i_1 = j_1, \varphi \circ i_2 = j_2$.
    
    A common notation is $P = X \sqcup_{Z} Y$.
  \end{definition}

  \begin{definition}
    The amalgamated free product $G_1 \ast_F G_2$ is the pushout $G_1 \sqcup_{F} G_2$. That
    is, given $\psi_1 :: F \to G_1, \psi_2 :: F \to G_2$, the amalgamated free product is a tuple
    $(G, i_1, i_2)$ such that $G$ is a group, $i_1, i_2$ are homomorphisms from $G_1$ to $G$ and
    $G_2$ to $G$, respectively, with $i_1 \circ \psi_1 = i_2 \circ \psi_2$. It should also satisfied
    the following universal property: given $(H, j_1, j_2)$ such that $H$ is a group,
    $j_1, j_2$ are homomorphisms from $G_1$ to $H$ and $G_2$ to
    $H$, with $j_1 \circ \psi_1 = j_2 \circ \psi_2$, then there exists a unique homomorphism
    $\varphi$ such that $j_1 = \varphi \circ i_1, j_2 = \varphi \circ i_2$.
  \end{definition}

  \begin{figure}[h]
    \centering
    \begin{tikzpicture}
      \matrix (m) [matrix of math nodes, row sep=2.5em, column sep=3em] {
        & G_1 & & \\
        F & G_1 \ast_F G_2 & & H \\
        & G_2 & & \\
      };
      \path[-latex]
      (m-2-1) edge node[midway, xshift=-2mm, yshift=2mm]{$\psi_1$} (m-1-2);
      \path[-latex]
      (m-2-1) edge node[midway, xshift=-2mm, yshift=-2mm]{$\psi_2$} (m-3-2);
      \path[-latex]
      (m-1-2) edge node[right]{$i_1$} (m-2-2);
      \path[-latex]
      (m-3-2) edge node[right]{$i_2$} (m-2-2);

      \path[-latex]
      (m-1-2) edge node[midway, xshift=2mm, yshift=2mm]{$j_1$} (m-2-4);
      \path[-latex]
      (m-3-2) edge node[midway, xshift=2mm, yshift=-2mm]{$j_2$} (m-2-4);

      \path[-latex]
      (m-2-2) edge node[pos=0.4, above]{$\varphi$} (m-2-4);
    \end{tikzpicture}
    \caption{The diagram of the amalgamated free product}
  \end{figure}

  \begin{proposition}
    Amalgamate free product exists and is unique up to isomorphism.
  \end{proposition}

  \begin{proof}
    Consider the free product $G_1 \ast G_2$, where $\tilde{i_1}, \tilde{i_2}$ are
    homomorphisms given by the free product from $G_1$ to $G_1 \ast G_2$ and $G_2$ to $G_1 \ast G_2$.

    We construct $G_1 \ast_F G_2 = (G_1 \ast G_2) / N$,
    where $N$ is the smallest normal subgroup containing the elements
    $\left\{ \left[\psi_1(x) \psi_2(x)^{-1}\right] : x \in F \right\}$ in $G_1 \ast G_2$.
    Let $q$ be the quotient map $G_1 \ast G_2 \to G_1 \ast G_2 / N$ and
    $i_1 = q \circ \tilde{i}_1, i_2 = q \circ \tilde{i}_2$. Then for all $x \in F$,
    \[ i_1(\psi_1(x))\, i_2(\psi_2(x))^{-1}
      = q(\tilde{i}_1(\psi_1(x))) \, q\big(\tilde{i}_2\left(\psi_2(x)^{-1}\right)\big)
      = q \big([\psi_1(x)][\psi_2(x)^{-1}]\big) = q([\psi_1(x)\psi_2(x)^{-1}]) = 1
    \]
    Hence $i_1(\psi_1(x)) = i_2(\psi_2(x)), \forall x \implies i_1 \circ \psi_1 = i_2 \circ \psi_2$.

    Now, given $H, j_1, j_2$. By the universal property of free product, exists $\tilde{\varphi}$ such
    that $\tilde{\varphi} \circ \tilde{i}_\alpha = j_\alpha$ for $\alpha \in \{1, 2\}$.

    Next, for all $x \in F$, $[\psi_1(x) \psi_2(x)^{-1}] = [\psi_1(x)] [\psi_2(x)^{-1}]
    = \tilde{i}_1(\psi_1(x))\, \tilde{i}_2\big(\psi_2(x)^{-1}\big)$, so
    \[ \tilde{\varphi}\big([\psi_1(x) \psi_2(x)^{-1}]\big) = 
      (\tilde{\varphi} \circ \tilde{i}_1) (\psi_1(x))\, 
      (\tilde{\varphi} \circ \tilde{i}_2) \big(\psi_2(x)^{-1}\big)
      = (j_1 \circ \psi_1)(x) \, \big((j_2 \circ \psi_2)(x)\big)^{-1} = 1 \]
    since $j_1 \circ \psi_1 = j_2 \circ \psi_2$. By the fact that $N$ is the smallest
    normal subgroup containing \\
    $\left\{ \left[\psi_1(x) \psi_2(x)^{-1}\right] : x \in F \right\}$,
    we conclude that $N \subseteq \ker \tilde{\varphi}$, and consequently $\tilde{\varphi}$
    descends into a homomorphism $\varphi :: G_1 \ast_F G_2 \to H$. And we have
    $ \varphi \circ i_\alpha = \varphi \circ q \circ \tilde{i}_\alpha = \tilde{i}_\alpha \circ \tilde{\varphi}
    = j_\alpha $ for $\alpha \in \{1, 2\}$, hence $\varphi$ satisfies the requirements.

    Finally, for the uniqueness, suppose $\varphi$ makes $j_\alpha = i_\alpha \circ \varphi$ for
    $\alpha \in \{1, 2\}$.
    then consider $h = \varphi \circ q$, since
    $ h \circ \tilde{i}_\alpha = \varphi \circ q \circ \tilde{i}_\alpha = i_\alpha \circ \varphi = j_\alpha$
    So $h$ is determined for all $x \in \Image{\tilde{i}_1} \cup \Image{\tilde{i}_2}$. But 
    $\Image{\tilde{i}_1} \cup \Image{\tilde{i}_2}$ contains all the generators of $G_1 \ast G_2$ 
    (i.e., all the reduced words with length $1$ and the empty word),
    hence $h$ is uniquely determined. Since $q$ is onto, we conclude 
    that $\varphi$ is also uniquely determined.

    \begin{figure}[h]
      \centering
      \begin{tikzpicture}
        \matrix (m) [matrix of math nodes, row sep=2.5em, column sep=3em] {
           & & G_1 & & \\
           F & G_1 \ast G_2 & G_1 \ast_F G_2 & & H \\
           & & G_2 & & \\
        };
        \path[-latex]
        (m-2-1) edge node[midway, xshift=-2mm, yshift=2mm]{$\psi_1$} (m-1-3);
        \path[-latex]
        (m-2-1) edge node[midway, xshift=-2mm, yshift=-2mm]{$\psi_2$} (m-3-3);
        \path[-latex]
        (m-1-3) edge node[right]{$i_1$} (m-2-3);
        \path[-latex]
        (m-3-3) edge node[pos=0.4, right]{$i_2$} (m-2-3);

        \path[-latex]
        (m-1-3) edge node[midway, xshift=2mm, yshift=2mm]{$j_1$} (m-2-5);
        \path[-latex]
        (m-3-3) edge node[midway, xshift=2mm, yshift=-2mm]{$j_2$} (m-2-5);

        \path[-latex]
        (m-2-3) edge node[pos=0.4, above]{$\varphi$} (m-2-5);

        \path[-latex]
        (m-1-3) edge node[midway, xshift=3mm, yshift=-1.2mm]{$\tilde{i}_1$} (m-2-2);

        \path[-latex]
        (m-3-3) edge node[midway, xshift=3.5mm, yshift=1mm]{$\tilde{i}_2$} (m-2-2);

        \path[-latex]
        (m-2-2) edge node[pos=0.4, above]{$q$} (m-2-3);

        \path[-latex]
        (m-2-2) edge[bend right=14] node[pos=0.6, below, yshift=0.5mm]{$\tilde{\varphi}$} (m-2-5);
      \end{tikzpicture}
      \caption{The diagram of groups and maps mentioned in the proof}
    \end{figure}
  \end{proof}

  For readers interested in applications of free product, the textbook mentioned the
  {\bf Seifert–van Kampen theorem} in algebraic topology, which states that if $X$ is 
  a topological space which is the union of two open and path connected subspaces $U_1, U_2$,
  and there intersection is path connected and nonempty. Then the fundamental group
  of $X$ is the free product of the fundamental groups $U_1, U_2$ amalgamated by
  the fundamental groups of $U_1 \cup U_2$.

\end{document}
